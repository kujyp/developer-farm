# 6ì£¼ì°¨ TIL

1. bookshortsì˜ ê¸°ëŠ¥ì„ ê³ ë„í™” - ê°ì¢… ë””ë²„ê¹…, ë¡œê·¸ì¸ íšŒì›ê°€ì… ê¸°ëŠ¥ ìŠ¤ë¬´ìŠ¤ - ì§€ê¸ˆì€ ë˜ login_required ê¸°ëŠ¥ ì¶”ê°€í–ˆë”ë‹ˆ ì˜ ì•ˆ ëŒì•„ê°€ê¸´ í•¨
	1. ê·¸ ê³¼ì •ì—ì„œ Flask-WTFì˜ flowì— ëŒ€í•´ì„œ íŒŒë³´ì•˜ë‹¤. [Flask-WTF í”„ë¡œì„¸ìŠ¤ ì‰½ê²Œ ì„¤ëª…í•œ ê¸€ (tistory.com)](https://jpotw.tistory.com/entry/Flask-WTF-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%89%BD%EA%B2%8C-%EC%84%A4%EB%AA%85%ED%95%9C-%EA%B8%80)
2. insight_extract RAG 1ì°¨ ì™„ ë””ìì¸ì€ êµ¬ë¦¼
	1. ê·¸ ê³¼ì •ì—ì„œ RAGì— ëŒ€í•´ ì¢€ ê³µë¶€í•  ìˆ˜ ìˆì—ˆìŒ
3. inganjipyo ë¦¬ì„œì¹˜í•¨. í”Œë ˆì´ìŠ¤í† ì–´ ì¼ì¼ ë‹¤ìš´ë¡œë“œ ì§€ìˆ˜ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì€ ìƒê°ë³´ë‹¤ ì–´ë ¤ì›€. ìœ ë£Œê¹Œì§€ ê°€ë©´ ë¶ˆê°€ëŠ¥í•˜ì§„ ì•Šì€ë“¯.
4. 101 For Dummies ë§Œë“¦. ì¼ì£¼ì¼ì— í•œ ë²ˆì”©ì€ ì •ë…í•˜ì (ì„¸ì„¸í•œ ê±° ë³´ì§€ë§ê³  ê·¸ëƒ¥ ì´ëŸ° ê²Œ ìˆë‹¤ ì‹ìœ¼ë¡œ ëˆˆëŒ€ì¤‘)


# 2024-01-08

í˜¹ì‹œ PromptTemplateì„ ì œëŒ€ë¡œ ì„¤ì • ì•ˆ í•´ì¤˜ì„œ ê·¸ëŸ° ê²Œ ì•„ë‹ê¹Œ?
PromptTemplateì„ ìˆ˜ì •í•´ë³´ê³  ê²°ê³¼ê°€ ì–´ë–¤ì§€ í™•ì¸í•´ë³´ì


ì¼ë‹¨ Huggingface Embeddings ë¡œ í•œêµ­ì–´ íŠ¹í™” ì„ë² ë”©ì„ í•˜ì

Solar 10 7bê°€ ìš”ì¦˜ ê°€ì¥ í•«í•œ í•œêµ­ì–´ ëª¨ë¸ì´ë¼ í•¨
[LDCC/LDCC-SOLAR-10.7B Â· Hugging Face](https://huggingface.co/LDCC/LDCC-SOLAR-10.7B)

í™•ì¸í•˜ëŠ” ë²•: [Open Ko-LLM Leaderboard - a Hugging Face Space by upstage](https://huggingface.co/spaces/upstage/open-ko-llm-leaderboard)
ko-llm ë¦¬ë”ë³´ë“œ ë“¤ì–´ê°€ì„œ ë³´ë©´ ë¨


```
load_dotenv()

inference_api_key = os.getenv("HUGGINGFACEHUB_API_TOKEN")

model_name="LDCC/LDCC-SOLAR-10.7B"
model_kwargs= {'device': 'cpu'}
encode_kwargs={'normalize_embeddings': True}

hf = HuggingFaceEmbeddings(
Â  Â  model_name=model_name,
Â  Â  model_kwargs=model_kwargs,
Â  Â  encode_kwargs=encode_kwargs
)

db = Chroma.from_documents(
docs,
embeddings=hf,
persistent_derectory = "ì›í•˜ëŠ” ì´ë¦„" # ì´ë˜ì•¼ì§€ ì„ë² ë”© ìƒì„± ì¤‘ë³µ ë°©ì§€ ã„±ã„´
)
```

ìœ íŠœë¸Œ ì°¸ì¡°í•¨


## ë­ì²´ì¸ ìµœì‹ ë¬¸ì„œ ì°¾ìŒ

docsì— ì¨ ìˆëŠ”ëŒ€ë¡œ importí–ˆëŠ”ë° 
ModuleNotFoundError: No module named 'langchain_community'
ëœ¸

êµ¬ê¸€ë§ í–ˆëŠ”ë° ìê¾¸ No module named 'langchain' í•´ê²°í•˜ëŠ” ë²•ë§Œ ëœ¸.

êµ¬ê¸€ì— Langchain Huggingface Embeddings ì¹˜ë‹ˆ ìµœì‹  ê³µì‹ ë¬¸ì„œ ë– ì„œ ê·¸ëŒ€ë¡œ ì¼ë”ë‹ˆ í•´ê²°ë¨

ì´ê²Œ ìµœì‹  ê³µì‹ ë¬¸ì„œ: ì—¬ê¸° Ctrl+F ì¹˜ë©´ ë‹¤ ë‚˜ì˜´. ë­ì²´ì¸ docsë³´ë‹¤ ì´ê²Œ ë” ì¢‹ì€ê±° ê°™ì€ë°???
ì–˜ë„¤ëŠ” ì—…ë°ì´íŠ¸ë¥¼ í•˜ë„ ë§ì´ í•´ì„œ ìµœì‹  ë¬¸ì„œë¥¼ ì°¾ëŠ” ê²Œ ë” ì¢‹ìŒ
[langchain_community 0.0.9 â€” ğŸ¦œğŸ”— LangChain 0.1.0](https://api.python.langchain.com/en/latest/community_api_reference.html#module-langchain_community.document_loaders)



## í—ˆê¹… í˜ì´ìŠ¤ëŠ” ì²˜ìŒ ë‹¤ìš´ ë°›ì„ ë•Œ ì´ëŸ°ë‹¤
```
PS C:\kakao_extract> python 1.py
Downloading .gitattributes: 100%|â–ˆ| 1.52k/1.52k [00:00<00:0
Downloading README.md: 100%|â–ˆ| 1.02k/1.02k [00:00<00:00, 1.
Downloading config.json: 100%|â–ˆâ–ˆâ–ˆâ–ˆ| 641/641 [00:00<?, ?B/s]
Downloading generation_config.json: 100%|â–ˆ| 133/133 [00:00<
Downloading (â€¦)of-00005.safetensors:   1%| | 41.9M/4.96G [0
```


## êµ¬ê¸€ ì½œë©ì€ ì‹ ì´ë‹¤

ê± ìš©ëŸ‰ í°ê±° ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ì½œë©ìœ¼ë¡œ ëŒë¦¬ì 
ë§í•  í—ˆê¹…í˜ì´ìŠ¤ê°€ ë‹¤ìš´ì´ 4ì‹œê°„ì´ ë„˜ê²Œ ê±¸ë¦° ì´ìœ : ì»´í“¨í„°ê°€ êµ¬ë°ê¸°ì—¬ì„œ

GPUëŠ” ì‹ ì´ë‹¤! êµ¬ê¸€ colabì€ ì‹ ì´ë‹¤!

ì¸ ì¤„ ì•Œì•˜ëŠ”ë°

colab ì™œ ë³€ìˆ˜ë“±ë¡í•˜ê³  ì•„ë˜ì— ì“°ë©´ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ê³  í•¨.. 



ì¼ë‹¨ í•´ì•¼ ë  ê±°:
RAG ì¢€ ì œëŒ€ë¡œ ëŒë ¤ë³´ê¸°..ã…‡ã…‡



# 2024-01-09

## Flask-RESTful document

>The main building block provided by Flask-RESTful are resources. Resources are built on top ofÂ [Flask pluggable views](http://flask.pocoo.org/docs/views/), giving you easy access to multiple HTTP methods just by defining methods on your resource.

"Resources"ê°€ ê¸°ë³¸, resources ëŠ” method(Class ì•ˆì˜ í•¨ìˆ˜)ë¡œ ì‰½ê²Œ ì •ì˜í•  ìˆ˜ ìˆë‹¤ê³  í•¨.


```
from flask import Flask
from flask_restful import Resource, Api

app = Flask(__name__)
api = Api(app) # ì´ê²Œ ë­ì„

todos= {}

class ToDoSimple(Resources):
	def get(self, todo_id):
        return {todo_id: todos[todo_id]}

    def put(self, todo_id):
        todos[todo_id] = request.form['data']
        return {todo_id: todos[todo_id]}

api.add_resource(TodoSimple, '/<string:todo_id>') # ì´ê²ƒë„ ë­ì„

if __name__ == '__main__':
    app.run(debug=True)
```

ë¬´ì¡°ê±´ json í˜•ì‹(python dictionary)ìœ¼ë¡œ ë‚˜íƒ€ë‚´ì•¼ í•œë‹¤


ê·¸ëŸ¬ë‹ˆê¹Œ ì´ê±¸ë¡œ CRUD ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆê² ë„¤


## requirements.txt íŒŒì¼ installment ë‹¤ìš´ë°›ëŠ” ë²•

```
pip install -r requirements.txt
```



```
íŒŒì¼ì´ ì•ˆ ëŒì•„ê°€ë©´ ì´ë¦„ì„ ë‹¤ì‹œ í•œ ë²ˆ ì‚´í´ë³´ì(Flask íŠ¹íˆ)
__init__.py
```


form functionì„ ì“¸ë•ŒëŠ” actionë„



## ëª¨ë¥´ê² ëŠ”ê±° ëª¨ìŒ â†’ ë‹µë³€ - 240110 ê°œë°œìƒë‹´ ì°¸ê³ 

### 1. ëª¨ë¥´ëŠ” ê±¸ ì–´ë–»ê²Œ ê²€ìƒ‰í•˜ë‚˜ìš”?

ìŠ¤íƒ€ì¼ ì°¨ì´ì¼ìˆ˜ë„ ìˆëŠ”ë° í•˜ë‹¤ê°€ ë§‰íˆëŠ” ê±° ìƒê¸°ë©´ 10ë¶„ ì•ˆì— ëª» ì°¾ìœ¼ë©´ ë„˜ì–´ê°€ê¸°? vs ë ë•Œê¹Œì§€ ê³„ì†ì°¾ê¸°

ê²€ìƒ‰ íŒ ??


### 2.

ex.
```
@bp.route('/', methods=['GET', 'POST'])
def answer():
Â  Â  if request.method == 'POST':
Â  Â  Â  Â  retriever=db.as_retriever(search_kwargs={"k":3}) #í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ retrieverë¡œ ì„¤ì •
Â  Â  Â  Â  question = request.form.get('question')
Â  Â  Â  Â  docs = retriever.get_relevant_documents(question)
Â  Â  Â  Â  # print(type(question)) #str
Â  Â  # Â  Â  # ë‚˜ëŠ” ì—¬ê¸°ì„œ ë§‰í˜€ìˆë‹¤. ì™œ docsê°€ ë¹ˆì¹¸ì´ ë‚˜ì˜¤ì§€
Â  Â  Â  Â  print(retriever)
Â  Â  Â  Â  doc_content=[]
Â  Â  Â  Â  for doc in docs:
Â  Â  Â  Â  Â  Â  doc_content.append(doc.page_content)
Â  Â  Â  Â  print(doc_content)
Â  Â  Â  Â  return render_template('answer.html', doc_content=doc_content)
Â  Â  else:
Â  Â  Â  Â  return render_template('main.html')

```

ê°„ë‹¨í•œ Flask ì— Langchain ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ìš©ì¤‘.

ì›ë˜ë¼ë©´ retriever.get_relevant_documents(question)ì„ í•˜ë©´ docsê°€ ë‚˜ì™€ì•¼ëŒ. ê·¼ë° docsê°€ ê³„ì† ë¹ˆì¹¸ìœ¼ë¡œ ë‚˜ì˜´:[]

ì¸í„°ë„·ì— langchain retriever.get_relevant, langchain retriever ë‹¤ ì³ ë´„

![](https://i.imgur.com/Lb2l7sM.png)

Langchain Docsì— ë‚˜ì˜¤ëŠ” ê·¸ëŒ€ë¡œ í–ˆëŠ”ë° ê³„ì† ë¹ˆê°’ì„



```
bp = Blueprint('main', __name__, url_prefix='/')


load_dotenv()
openai_api_key=os.getenv("OPENAI_API_KEY")
chat=ChatOpenAI()
embeddings=OpenAIEmbeddings()
db=Chroma(
Â  Â  Â  Â  Â  Â  persist_directory="/emb",
Â  Â  Â  Â  Â  Â  embedding_function=embeddings
Â  Â  Â  Â  )
@bp.route('/', methods=['GET', 'POST'])
def answer():
Â  Â  if request.method == 'POST':
Â  Â  Â  Â  retriever=db.as_retriever() #í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ retrieverë¡œ ì„¤ì •
Â  Â  Â  Â  question = request.form.get('question')
Â  Â  Â  Â  docs = retriever.get_relevant_documents(question, k=1)
Â  Â  Â  Â  print(question)
Â  Â  Â  Â  print(docs) #ëŒ€ì²´ ì™œ ë¹ˆê°’ì„
Â  Â  Â  Â  return render_template('answer.html')
Â  Â  else:
Â  Â  Â  Â  return render_template('main.html')
```

ì•„ë‹ˆ ì´ê²Œ ì™œ ì•ˆ ë¨



(2024-01-10)
ì™œ ëëŠ”ì§€ ëª¨ë¥´ê² ëŠ”ë°

embeddingsë¥¼ huggingfaceê±¸ë¡œ ë°”ê¾¸ë‹ˆê¹Œ ì˜ ë¨ ..
1. ì²˜ìŒì—ëŠ” 1.pyë¥¼ ì´ìš©í•´ì„œ dbë§Œ huggingfaceë¡œ ë°”ê¿¨ë‹¤ê°€ 
	1. ë˜‘ê°™ì´ ì•ˆ ë¼ì„œ main_views.py ê²ƒë„ ë°”ê¿”ì¤Œ
ì•„ì§ë„ ì•ˆ ëœ ì´ìœ ëŠ” ì˜ ëª¨ë¥´ê² ìŒ
1. persist directoryë¥¼ ì ˆëŒ€ê²½ë¡œë¡œ ì„¤ì •í•´ì„œ ê·¸ëŸ°ê±´ê°€??


### 3. ë„ì›€ë  ë§Œí•œ ì˜¤í”ˆì†ŒìŠ¤ ì½”ë“œ ì°¾ì•˜ëŠ”ë° ì½ì„ ì§¬ì´ ì•ˆ ë˜ëŠ” ê±° ê°™ìŒ

ëŒ€ê°€ë¦¬ ê¹¨ì ¸ê°€ë©´ì„œ ì½ê¸° vs ê³µë¶€ë‚˜ í•˜ì…ˆ

```
request = response.get("{api end point}")
```




## REST APIì— ëŒ€í•˜ì—¬ 

ì–´ë–¤ APIë“¤ì€ parametersê°€ í•„ìš”í•˜ë‹¤
API document ì—ì„œ ì°¸ì¡°


## REST ìŠ¤íƒ€ì¼ API ë§Œë“œëŠ” ë²•

### HTTP Request Verbs
1. GET
2. POST
3. PUT/PATCH
4. DELETE



## Whipser API ì„¸íŒ…

ë¬´ë£Œ STTí•˜ëŠ” ë²• ì°¾ì•„ë²Œì„


# 2024-01-10


flask templatesì˜ htmlíŒŒì¼ë“¤ì€ for loopì„ ì“¸ ë•Œ ì•ˆì— {{}} ì“°ì§€ X 

Ex.
```html
{% extends "base.html" %}
{% block title %}ê´€ë ¨ ë¬¸ì„œ í˜ì´ì§€{% endblock %}
{% block content %}
Â  Â  <h1>ê´€ë ¨ ë¬¸ì„œ</h1>
Â  Â  <ul>
Â  Â  Â  Â  {% for answer in relevant_docs %}
Â  Â  Â  Â  Â  Â  <li>
Â  Â  Â  Â  Â  Â  Â  Â  {{ answer }}
Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  {% endfor %}
Â  Â  </ul>
{% endblock %}
```



## í”„ë¡œê·¸ë¨ì´ ì‹œì‘ë¶€í„° ì•ˆ ëŒì•„ê°€ë©´ 
1. í•¨ìˆ˜ì˜ ë¬¸ì œëŠ” ì•„ë‹˜
2. ìˆœì„œì˜ ë¬¸ì œì¼ ìˆ˜ ìˆìŒ (ì •ì˜ ì•ˆ ëœ ê±¸ ëŒë ¤ë²„ë¦°ë‹¤ë“ ê°€)
3. ì½”ë“œ ìœ—ë¶€ë¶„ì˜ ë¬¸ì œì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ



# 2024-01-11


ì™œ ì¸ì§€ ëª¨ë¥´ê² ì§€ë§Œ fontë¥¼ ê°–ê³ ì™€ë„ ì¸ì‹í•˜ì§€ ëª»í•¨ã…œ

findfont: Font family 'font.ttf' not found.


ê·¸ë˜í”„ë¡œ í‘œí˜„í•  ë°©ë²•ì„ ì°¾ë‹¤ê°€ Copilotì´ matplotlib ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ì²œí•´ì¤Œ

```python
pip install matplotlib
import matplotlib.pyplot as plt # ì´ê²Œ í”Œë¡¯ì°¨íŠ¸ë¥¼ ê·¸ë ¤ì¤€ë‹¤ ë§¤ìš° ì†ì‰½
Â # ë°ì´í„° ë¶„ë¦¬
Â  Â  dates = [item['period'] for item in data['results'][0]['data']]
Â  Â  ratios = [item['ratio'] for item in data['results'][0]['data']]

Â  Â  # ê·¸ë˜í”„ ìƒì„±
Â    plt.rc('font', family="font.ttf")
Â  Â  plt.plot(dates, ratios)
Â  Â  plt.xlabel('date')
Â  Â  plt.ylabel('search rate')
Â  Â  plt.title('Bitcoin Inganjipyo')
Â  Â  plt.show()

```

ëŒ€ì¶© xì™€ y ë°ì´í„°ë¥¼ ê°ê° ë¶„ë¦¬í•´ì„œ ë¶ˆëŸ¬ì˜¨ë‹¤.

ê·¸ë‹¤ìŒ plt.rc, plot, xlabel, ylabel, title, showë¥¼ í†µí•´ ê·¸ë˜í”„ë¥¼ ì†ì‰½ê²Œ ê·¸ë¦´ ìˆ˜ ìˆìŒ


ê·¼ë° í°íŠ¸ê°€ ì™œ ì•ˆ ë¨¹íˆëŠ”ì§€ ëª¨ë¥´ê² ìŒ (ê·¸ë˜ì„œ ì¼ë‹¨ ì˜¤ë¥˜ ì•ˆ ëœ¨ê²Œ ì˜ì–´ë¡œ ë°”ê¿”ë†“ìŒ)



dataë¥¼ jsoní˜•íƒœë¡œ ë°›ì•˜ë‹¤.

ëŒ€ì¶© ì´ëŸ°ì‹ìœ¼ë¡œ ë‚˜ì˜¬ ê²ƒì´ë‹¤:
```python
body = {
    "startDate": "2023-11-30",
    "endDate": "2024-01-10",
    "timeUnit": "week",
    "keywordGroups": [
        {
            "groupName": "ë¹„íŠ¸ì½”ì¸",
            "keywords": ["ë¹„íŠ¸ì½”ì¸", "ë¹„íŠ¸ì½”ì¸ ê°€ê²©"]
        }
    ],
    "device": "pc",
    "ages": ["1", "2"],
    "gender": "f"
}
# bodyì—ì„œ ì •ì˜í•œ ëŒ€ë¡œ keyê°’ë“¤ì´ ë‚˜ì˜¤ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```


ì•ìœ¼ë¡œ ì½”ë“œ ì§œê³  ì´í•´ ì•ˆ ë˜ë©´ í•œì¤„í•œì¤„ ì„¤ëª… ë“£ê³  ê·¸ë˜ë„ ì´í•´ ì•ˆ ë˜ë©´ í‚¤ì›Œë“œ ì ê³  ë‚˜ì¤‘ì— ë³µìŠµ/ì§‘ì¤‘íƒêµ¬ ã„±ã„±

#Keyword:
**matplotlib**
**urllib** (url handling modules) [urllib â€” URL handling modules â€” Python 3.12.1 documentation](https://docs.python.org/3/library/urllib.html)
**json.loads** `json` ëª¨ë“ˆì€ JSON í˜•ì‹ì˜ ë°ì´í„°ë¥¼ íŒŒì´ì¬ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ëª¨ë“ˆì…ë‹ˆë‹¤. JSON í˜•ì‹ì˜ ë¬¸ìì—´ì„ íŒŒì´ì¬ ê°ì²´ë¡œ ë³€í™˜í•˜ê±°ë‚˜, íŒŒì´ì¬ ê°ì²´ë¥¼ JSON í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì— ì‚¬ìš©ë©ë‹ˆë‹¤.


[[python.keywords]]





# 2024-01-14


### `AttributeError: module 'openai' has no attribute 'error'`

insight_extract ì—ì„œ  AttributeError: module 'openai' has no attribute 'error' ê°€ ê³„ì† ë–´ìŒ. ChatGPTí•œí…Œ ë¬¼ì–´ë´ë„ ë”±íˆ ì–»ì€ ê²Œ ì—†ì—ˆë‹¤ ê·¼ë° 
êµ¬ê¸€ë§ í•˜ë‹ˆ
[[langchain + openai ì—ëŸ¬] AttributeError: module 'openai' has no attribute 'error' (tistory.com)](https://dtbb.tistory.com/18)

ê³ ë§ˆìš°ì‹  ë¶„ê»˜ì„œ langchain versionì„ ë‚®ì¶°ì•¼ í•œë‹¤ê³  ë§ì”€í•´ì£¼ì‹¬. ë„ˆë¬´ ìµœì‹  ë²„ì „ì€ ì•ˆì •í™”ê°€ ì•ˆ ë¼ì„œ ì˜ ì‘ë™ì„ ì•ˆ í•œ ê±°ì˜€ìŒ. ê°ì‚¬í•¨ë‹ˆë‹¤.



ë§¤ì£¼ í•œ ë²ˆì”©ì€ 101 for dummiesë¥¼ ì½ì.
ë‚˜ëŠ” dummyë‹ˆê¹Œ..